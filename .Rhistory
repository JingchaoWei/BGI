#对矩阵的名字进行替换
colnames(data) <- names_cluster$new_names
colnames(data)
#然后进行聚类
distance <- dist(t(data),method="maximum")
clusters <- hclust(distance,method = "complete")
plot(clusters)
#然后进行聚类
distance <- dist(t(data),method="euclidean")
clusters <- hclust(distance,method = "complete")
plot(clusters)
#然后进行聚类
distance <- dist(t(data),method="euclidean")
clusters <- hclust(distance,method = "complete")
plot(clusters)
pdf("sample_cluster.pdf")
par(mar = c(5, 5, 5, 3))#图的下，左，上，右到页面的边距
par(mgp = c(1.5, 0.5, 0))
plot(clusters)
dev.off()
View(data)
View(data)
# Define nodePar
nodePar <- list(lab.cex = 0.6, pch = c(NA, 19),
cex = 0.7, col = "blue")
hc=hclust(dist(t(data)))
par(mar=c(5,5,5,10))
png('hclust.png',res=120,height = 1800)
plot(as.dendrogram(hc), nodePar = nodePar, horiz = TRUE)
dev.off()
nodePar <- list(lab.cex = 0.6, pch = c(NA, 19),
cex = 0.7, col = "blue")
hc=hclust(dist(t(data)))
par(mar=c(5,5,5,10))
pdf('hclust.pdf')
plot(as.dendrogram(hc), nodePar = nodePar, horiz = TRUE)
dev.off()
nodePar
library(clusterProfiler)
data(gcSample)
str(gcSample)
View(gcSample)
gcSample
x <- compareCluster(gcSample, 'enrichDO')
x <- compareCluster(gcSample,fun = 'enrichDO')
x <- compareCluster(gcSample,fun = 'enrichGO')
data(gcSample)
gcSample
str(gcSample)
# Sat Nov 17 18:15:24 2018 ------------------------------
rm(list=ls())
load('Data.Rdata')
index <- grep('BGI',upgenes$ï..Gene.ID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
index <- grep('BGI',background_all$ï..Gene.ID)
background_all <- background_all[-index,]#filter out BGI_novel genes.
index <- grep('BGI',background_DEG$ï..Gene.ID)
background_DEG <- background_DEG[-index,]
entr_up <- as.vector(upgenes$ï..Gene.ID)
entr_bg <- as.vector(background_all$ï..Gene.ID)
library(clusterProfiler)
library(org.Hs.eg.db)
library(enrichplot)
library(pathview)
library(stringr)
library(dplyr)
#kegg over-representation test
kk <- enrichKEGG(gene         = entr_up,
organism     = 'hsa',
pvalueCutoff = 0.05,minGSSize = 10, maxGSSize = 500,use_internal_data = F)
View(kk)
head(kk)
kk <- setReadable(kk,keytype = 'ENTREZID',OrgDb = org.Hs.eg.db)#转化ID
library(DOSE)
kk <- setReadable(kk,keytype = 'ENTREZID',OrgDb = org.Hs.eg.db)#转化ID
barplot(kk,drop=T,showCategory = 20,x = "GeneRatio")
dotplot(kk,showCategory = 20)
emapplot(kk, showCategory=20,color = "p.adjust",layout = 'kk')
dotplot(kk,showCategory = 20)
#get genes in significant pathways
sig_genes_tmp <- kk@result
sig_genes_tmp <- sig_genes_tmp[sig_genes_tmp$p.adjust<0.05,]
MySplit <- function(i){
tmp <- sig_genes_tmp[i,'geneID'] %>% str_split(pattern = '/') %>% unlist(recursive = T)
return(tmp)
}
sig_genes <- vector()
for (i in 1:nrow(sig_genes_tmp)) {
tmp <- MySplit(i)
sig_genes <- c(sig_genes,tmp)
}
sig_genes <- unique(sig_genes)
cat(sig_genes,sep = '\n')#按行打印出来，可以直接复制到stringDB里面做蛋白相互作用
#KEGG Gene Set Enrichment Analysis
geneList <- background_all$log2.HN.FK.
names(geneList) <- as.character(background_all$ï..Gene.ID)
geneList <- sort(geneList,decreasing = T)
str(geneList)
kk@geneSets
str(kk@geneSets)
#比较基因集的生物学功能
compare <- compareCluster(geneClusters = kk@geneSets,fun = 'enrichKEGG')
str(compare)
plot(compare)
Plot(compare)
dotplot(compare)
str(kk@geneSets)
kk@geneSets[1]
kk@geneSets[1:2]
kk@geneSets[[1:2]]
#比较基因集的生物学功能
compare <- compareCluster(geneClusters = kk@geneSets[1:10],fun = 'enrichKEGG')
dotplot(compare)
#比较基因集的生物学功能
compare <- compareCluster(geneClusters = kk@geneSets[1:5],fun = 'enrichKEGG')
dotplot(compare)
#比较基因集的生物学功能
compare <- compareCluster(geneClusters = kk@geneSets[1:5],fun = 'enrichKEGG')
dotplot(compare)
dotplot(compare)+ scale_color_continuous(low='purple', high='green')
library(ggplot2)
dotplot(compare)+ scale_color_continuous(low='purple', high='green')
dotplot(compare)
#clusterProfiler出的图，我们可以随意改啊，比如改颜色
dotplot(compare)+ scale_color_continuous(low='purple', high='green')
View(kk)
rm(list=ls())
load('Data.Rdata')
index <- grep('BGI',upgenes$ï..Gene.ID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
index <- grep('BGI',background_all$ï..Gene.ID)
background_all <- background_all[-index,]#filter out BGI_novel genes.
index <- grep('BGI',background_DEG$ï..Gene.ID)
background_DEG <- background_DEG[-index,]
entr_up <- as.vector(upgenes$ï..Gene.ID)
entr_bg <- as.vector(background_all$ï..Gene.ID)
library(clusterProfiler)
library(org.Hs.eg.db)
library(enrichplot)
library(pathview)
library(stringr)
library(dplyr)
library(DOSE)
library(ggplot2)
#kegg over-representation test
kk <- enrichKEGG(gene         = entr_up,
organism     = 'hsa',
pvalueCutoff = 0.05,minGSSize = 10, maxGSSize = 500,use_internal_data = F)
head(kk)
kk <- setReadable(kk,keytype = 'ENTREZID',OrgDb = org.Hs.eg.db)#转化ID
#比较基因集的生物学功能，比如比较上下调基因
compare_up <- compareCluster(geneClusters = kk@geneSets[1:5],fun = 'enrichKEGG')
str(kk)
str(kk@result)
#比较基因集的生物学功能，比如比较上下调基因
geneset <- list(upgenes,downgenes)
str(geneset)
View(downgenes)
entr_down <- as.vector(downgenes$ï..Gene.ID)
#比较基因集的生物学功能，比如比较上下调基因
geneset <- list(entr_up,entr_down)
str(geneset)
compare <- compareCluster(geneClusters = geneset,fun = 'enrichKEGG')
#比较基因集的生物学功能，比如比较上下调基因
geneset <- list(entr_up,entr_down)
str(geneset)
compare <- compareCluster(geneClusters = geneset,fun = 'enrichKEGG')
dotplot(enrichKEGG(entr_down))
dotplot(enrichKEGG(entr_up))
View(geneset)
compare <- compareCluster(geneClusters = geneset,fun = 'enrichKEGG')
dotplot(compare)
geneset
index <- grep('BGI',downgenes$ï..Gene.ID)
downgenes <- downgenes[-index,]
entr_down <- as.vector(downgenes$ï..Gene.ID)
geneset
index <- grep('BGI',downgenes$ï..Gene.ID)
downgenes <- downgenes[-index,]
entr_down <- as.vector(downgenes$ï..Gene.ID)
geneset
View(downgenes)
# Sat Nov 17 18:15:24 2018 ------------------------------
rm(list=ls())
load('Data.Rdata')
index <- grep('BGI',downgenes$ï..Gene.ID)
downgenes <- downgenes[-index,]
index <- grep('BGI',upgenes$ï..Gene.ID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
index <- grep('BGI',background_all$ï..Gene.ID)
background_all <- background_all[-index,]#filter out BGI_novel genes.
entr_up <- as.vector(upgenes$ï..Gene.ID)
entr_down <- as.vector(downgenes$ï..Gene.ID)
entr_bg <- as.vector(background_all$ï..Gene.ID)
library(clusterProfiler)
library(org.Hs.eg.db)
library(enrichplot)
library(pathview)
library(stringr)
library(dplyr)
library(DOSE)
library(ggplot2)
library(pathview)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("pathview", version = "3.8")
library(pathview)
#比较基因集的生物学功能，比如比较上下调基因
geneset <- list(entr_up,entr_down)
geneset
compare <- compareCluster(geneClusters = geneset,fun = 'enrichKEGG')
dotplot(enrichKEGG(entr_up))
dotplot(enrichKEGG(entr_down))
data(gcSample)
str(gcSample)
compare <- compareCluster(geneClusters = gcSample,fun = 'enrichKEGG')
dotplot(compare)
gcSample
str(gcSample)
str(geneset)
names(geneset)<-c('1','2')
str(geneset)
compare <- compareCluster(geneClusters = geneset,fun = 'enrichKEGG')
names(geneset) <- c('Up','Down')#一定要给list命名，不然后面会报错
compare <- compareCluster(geneClusters = geneset,fun = 'enrichKEGG')
dotplot(compare)
geneList <- background_all$log2.HN.FK.
names(geneList) <- as.character(background_all$ï..Gene.ID)
geneList <- sort(geneList,decreasing = T)
mydf <- data.frame()
mydf <- data.frame(Entrez=names(geneList), FC=geneList)
View(mydf)
mydf <- mydf[abs(mydf$FC) > 1,]
mydf$group <- "upregulated"
mydf$group[mydf$FC < 0] <- "downregulated"
mydf$othergroup <- "A"
mydf$othergroup[abs(mydf$FC) > 2] <- "B"
formula_res <- compareCluster(Entrez~group+othergroup, data=mydf, fun="enrichKEGG")
dotplot(formula_res)
dotplot(formula_res)
dotplot(formula_res)
dotplot(formula_res, x=~group) + ggplot2::facet_grid(~othergroup)
dotplot(formula_res)
mydf$othergroup <- "FC<=2"
mydf <- data.frame(Entrez=names(geneList), FC=geneList)
mydf <- mydf[abs(mydf$FC) > 1,]
mydf$group <- "upregulated"
mydf$group[mydf$FC < 0] <- "downregulated"
mydf$othergroup <- "FC<=2"
mydf$othergroup[abs(mydf$FC) > 2] <- "FC>2"
formula_res <- compareCluster(Entrez~group+othergroup, data=mydf, fun="enrichKEGG")
head(as.data.frame(formula_res))
dotplot(formula_res)
formula_res <- compareCluster(Entrez~group, data=mydf, fun="enrichKEGG")
head(as.data.frame(formula_res))
dotplot(formula_res)
dotplot(formula_res, x=~group)
#比较基因集的生物学功能，比如比较上下调基因
geneset <- list(entr_up,entr_down)
names(geneset) <- c('Up','Down')#一定要给list命名，不然后面会报错
compare <- compareCluster(geneClusters = geneset,fun = 'enrichKEGG')
dotplot(compare)
mydf <- data.frame(Entrez=names(geneList), FC=geneList)
mydf <- mydf[abs(mydf$FC) > 2,]
mydf$group <- "upregulated"
mydf$group[mydf$FC < 0] <- "downregulated"
formula_res <- compareCluster(Entrez~group, data=mydf, fun="enrichKEGG")
head(as.data.frame(formula_res))
dotplot(formula_res)
background_DEG <- read.csv('DEG.csv')
background_all <- read.csv('all.csv')
attach(background_DEG)
head(background_DEG)
colnames(background_DEG)
colnames(background_all)
str(background_DEG)
background_DEG <- read.csv('DEG.csv',stringsAsFactors = F)
background_all <- read.csv('all.csv',stringsAsFactors = F)
colnames(background_all)
source('H:/Github/BGI/BGI.R', echo=TRUE)
background_DEG <- read.csv('DEG.csv',stringsAsFactors = F)
background_all <- read.csv('all.csv',stringsAsFactors = F)
colnames(background_all)
colnames(background_DEG)
background_DEG <- read.csv('DEG.csv',stringsAsFactors = F,encoding = 'UTF-8')
colnames(background_DEG)
background_DEG <- read.csv('DEG.csv',stringsAsFactors = F,encoding = 'Latin-1')
colnames(background_DEG)
background_DEG <- read.csv('DEG.csv',stringsAsFactors = F,check.names = T)
background_all <- read.csv('all.csv',stringsAsFactors = F,check.names = T)
colnames(background_all)
colnames(background_DEG)
background_all[1:9,1:9]
background_DEG <- read.csv('DEG.csv',stringsAsFactors = F,check.names = T)
background_all <- read.csv('all.csv',stringsAsFactors = F,check.names = T)
colnames(ba)
colnames(background_all)
colnames(background_DEG)
attach(background_DEG)
upgenes <- background_DEG[FK.FPKM>=1&HN.FPKM>=1&log2.HN.FK.>=2&Qvalue.FK.vs.HN.<0.01,]
downgenes <- background_DEG[FK.FPKM>=1&HN.FPKM>=1&log2.HN.FK.<=-2&Qvalue.FK.vs.HN.<0.01,]
detach(background_DEG)
save(background_DEG,upgenes,downgenes,background_all,file = 'Data.Rdata')
Sys.Date()
Sys.time()
date()
terrain.colors()
ts()
tsSmooth()
Sys.time()
rm(ls=list())
Sys.setlocale("LC_ALL","Chinese")
rm(list=ls())
rm(ls=list())
rm(list=ls())
data <- read.csv('all.csv')
colnames(data)
data <- data[,2:9]
library(Hmisc)
library(pheatmap)
install.packages('Hmisc')
install.packages("Hmisc")
install.packages('ggplot2')
options(repos='http://cran.rstudio.com/')
install.packages("Hmisc")
install.packages('ggplot2')
install.packages('pheatmap')
library(Hmisc)
library(pheatmap)
res <- rcorr(as.matrix(data))
pdf('Correlation_plot.pdf',onefile = T)
pheatmap(res$r,
col = colorRampPalette(c("#3399FF","white","red"))(100),
cluster_rows = T,cluster_cols=T,
clustering_distance_rows = 'correlation',clustering_distance_cols = 'correlation',
treeheight_row = 80,treeheight_col = 80,
display_numbers = T,number_color = 'black',fontsize_number = 10,
border_color = NA,legend=TRUE,
show_colnames=T,show_rownames=T,
fontsize_col = 10,
fontsize_row = 10,fontsize = 10,
main = 'Correlation')
library(corrplot)
corrplot(res$r,col = colorRampPalette(c("blue","white","red"))(100),
type='full',order='hclust',tl.col = "black",
diag=T,outline = T,bg = 'white',addgrid.col = 'black',
addCoef.col = 'black',tl.cex = 1,
p.mat = res$P,sig.level = 0.01,insig = 'blank',
number.digits = 2)
install.packages('corrplot')
library(corrplot)
corrplot(res$r,col = colorRampPalette(c("blue","white","red"))(100),
type='full',order='hclust',tl.col = "black",
diag=T,outline = T,bg = 'white',addgrid.col = 'black',
addCoef.col = 'black',tl.cex = 1,
p.mat = res$P,sig.level = 0.01,insig = 'blank',
number.digits = 2)
symnum(res$r)
dev.off()
names_cluster <- data.frame(sample=colnames(data),group=c(rep('FK',3),rep('HN',5)))
View(names_cluster)
names_cluster$group <- as.character(names_cluster$group)
names_cluster$new_names <- paste(names_cluster$sample,names_cluster$group,sep = "_")
names_cluster
colnames(data)
colnames(data) <- names_cluster$new_names
colnames(data)
names_cluster <- data.frame(sample=colnames(data),group=c(rep('FK',3),rep('HN',5)))
names_cluster$group <- as.character(names_cluster$group)
names_cluster
colnames(data)
colnames(data) <- names_cluster$new_names
colnames(data)
names_cluster <- data.frame(sample=colnames(data),group=c(rep('FK',3),rep('HN',5)))
names_cluster$group <- as.character(names_cluster$group)
distance <- dist(t(data),method="euclidean")
clusters <- hclust(distance,method = "complete")
pdf("sample_cluster.pdf")
par(mar = c(5, 5, 5, 3))#图的下，左，上，右到页面的边距
par(mgp = c(1.5, 0.5, 0))
plot(clusters)
dev.off()
colnames(data)
data <- read.csv('all.csv')
data <- data[,2:9]
colnames(data)
distance <- dist(t(data),method="euclidean")
clusters <- hclust(distance,method = "complete")
pdf("sample_cluster.pdf")
par(mar = c(5, 5, 5, 3))#图的下，左，上，右到页面的边距
par(mgp = c(1.5, 0.5, 0))
plot(clusters)
dev.off()
colnames(data)
library(stringr)
strsplit(colnames(data),split = '.')
strsplit(colnames(data),split = '.')
strsplit(colnames(data),split = '\.')
strsplit(colnames(data),split = '.',fixed = T)
unlist(strsplit(colnames(data),split = '.',fixed = T))
newnames <- unlist(strsplit(colnames(data),split = '.',fixed = T))
newnames
str(newnames)
newnames = newnames[-which(newnames=='FPKM')]
newnames
newnames <- unlist(strsplit(colnames(data),split = '.',fixed = T))
newnames = newnames[[-which(newnames=='FPKM')]]
newnames = newnames[-which(newnames=='FPKM')]
names_cluster$new_names <- newnames
names_cluster
colnames(data)
colnames(data) <- names_cluster$new_names
colnames(data)
distance <- dist(t(data),method="euclidean")
clusters <- hclust(distance,method = "complete")
pdf("sample_cluster.pdf")
par(mar = c(5, 5, 5, 3))#图的下，左，上，右到页面的边距
par(mgp = c(1.5, 0.5, 0))
plot(clusters)
dev.off()
rm(list=ls())
load('Data.Rdata')
View(downgenes)
index <- grep('BGI',upgenes$ï..Gene.ID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
index <- grep('BGI',background_all$ï..Gene.ID)
background_all <- background_all[-index,]#filter out BGI_novel genes.
index <- grep('BGI',background_DEG$ï..Gene.ID)
background_DEG <- background_DEG[-index,]
entr_up <- as.vector(upgenes$ï..Gene.ID)#这些上调的基因可以导入clueGO直接进行分析了。
rm(list=ls())
load('Data.Rdata')
index <- grep('BGI',upgenes$ï..Gene.ID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
rm(list=ls())
load('Data.Rdata')
index <- grep('BGI',upgenes$ï..Gene.ID)#Filter our BGI novel genes.
View(upgenes)
index <- grep('BGI',upgenes$GeneID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
rm(list=ls())
load('Data.Rdata')
index <- grep('BGI',upgenes$GeneID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
index <- grep('BGI',background_all$GeneID)
background_all <- background_all[-index,]#filter out BGI_novel genes.
index <- grep('BGI',background_DEG$GeneID)
background_DEG <- background_DEG[-index,]
index <- grep('BGI',downgenes$GeneID)#Filter our BGI novel genes.
downgenes <- downgenes[-index,]
entr_up <- as.vector(upgenes$GeneID)#这些上调的基因可以导入clueGO直接进行分析了。
entr_down <- as.vector(downgenes$GeneID)
entr_bg <- as.vector(background_all$GeneID)
write.table(entr_up,"upgene.txt",quote = F,sep = '\n',row.names = F,col.names = F)
write.table(entr_up,"upgene_for_ClueGo.txt",quote = F,sep = '\n',row.names = F,col.names = F)
write.table(entr_down,"downgene_for_ClueGo.txt",quote = F,sep = '\n',row.names = F,col.names = F)
entr_up_down <- c(entr_up,entr_down)
write.table(entr_up_down,"allgene_for_ClueGo.txt",quote = F,sep = '\n',row.names = F,col.names = F)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("clusterProfiler", version = "3.8")
chooseCRANmirror()
install.packages("installr")
require(installr)或者library("installr")
updateR()
options(repos='http://cran.rstudio.com/')
install.packages("installr")
require(installr)或者library("installr")
updateR()
library("installr")
updateR()
updateR()
install.packages("BiocManager")
BiocManager::install("clusterProfiler", version = "3.8")
install.packages("BiocManager")
install.packages("BiocManager")
updateR()
library("installr")
updateR()
setInternet2(TRUE)
setInternet2(TRUE)
# Fri Nov 16 15:44:08 2018 ------------------------------
rm(list=ls())
load('Data.Rdata')
index <- grep('BGI',upgenes$GeneID)#Filter our BGI novel genes.
upgenes <- upgenes[-index,]
index <- grep('BGI',downgenes$GeneID)#Filter our BGI novel genes.
downgenes <- downgenes[-index,]
index <- grep('BGI',background_all$GeneID)
background_all <- background_all[-index,]#filter out BGI_novel genes.
index <- grep('BGI',background_DEG$GeneID)
background_DEG <- background_DEG[-index,]
entr_up <- as.vector(upgenes$GeneID)#这些上调的基因可以导入clueGO直接进行分析了。
entr_down <- as.vector(downgenes$GeneID)
entr_bg <- as.vector(background_all$GeneID)
entr_up_down <- c(entr_up,entr_down)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("clusterProfiler", version = "3.8")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("org.Hs.eg.db", version = "3.8")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("enrichplot", version = "3.8")
library(clusterProfiler)
library(org.Hs.eg.db)
library(enrichplot)
ggo <- groupGO(gene = entr_up,OrgDb = org.Hs.eg.db,ont = 'BP',
level = 3,keyType = 'ENTREZID',readable = T)
# Fri Nov 16 15:44:08 2018 ------------------------------
rm(list=ls())
